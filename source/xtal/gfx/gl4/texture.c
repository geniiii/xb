// TODO(geni): Bad
global const u8 xgl_fallback_bmp[] = {
    0x42, 0x4D, 0xF6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x36, 0x00,
    0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x08, 0x00,
    0x00, 0x00, 0x01, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00,
    0x00, 0x00, 0x12, 0x0B, 0x00, 0x00, 0x12, 0x0B, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9,
    0xD8, 0x00, 0xF9, 0xD8, 0x00, 0xF9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

internal void XGL_TexParamI32(XGL_Tex tex, GLenum param, i32 value) {
    glTextureParameteri(tex.handle, param, value);
}
internal void XGL_TexParamF32(XGL_Tex tex, GLenum param, f32 value) {
    glTextureParameterf(tex.handle, param, value);
}

internal XGL_Tex XGL_TexNew(ivec2s size, XGL_TexFormat format, XGL_TexGPUFormat gpu_format, XGL_TexFiltering filtering, XGL_TexWrap wrap) {
    XGL_Tex tex = {
        .size       = size,
        .format     = format,
        .gpu_format = gpu_format,
    };
    glCreateTextures(GL_TEXTURE_2D, 1, &tex.handle);

    XGL_TexParamI32(tex, GL_TEXTURE_MIN_FILTER, filtering);
    XGL_TexParamI32(tex, GL_TEXTURE_MAG_FILTER, filtering);
    XGL_TexParamI32(tex, GL_TEXTURE_WRAP_S, wrap);
    XGL_TexParamI32(tex, GL_TEXTURE_WRAP_T, wrap);

    glTextureStorage2D(tex.handle, 1, format, size.width, size.height);

    return tex;
}

internal XGL_Tex XGL_TexNewWithData(ivec2s size, XGL_TexFormat format, XGL_TexGPUFormat gpu_format, XGL_TexFiltering filtering, XGL_TexWrap wrap, const void* data) {
    XGL_Tex tex = XGL_TexNew(size, format, gpu_format, filtering, wrap);
    glTextureSubImage2D(tex.handle, 0, 0, 0, size.width, size.height, gpu_format, GL_UNSIGNED_BYTE, data);
    return tex;
}

internal void XGL_TexUpdate(XGL_Tex tex, const void* data) {
    glTextureSubImage2D(tex.handle, 0, 0, 0, tex.size.width, tex.size.height, tex.gpu_format, GL_UNSIGNED_BYTE, data);
}
internal void XGL_TexDestroy(XGL_Tex tex) {
    glDeleteTextures(1, &tex.handle);
}

internal void XGL_TexBindToUnit(XGL_Tex tex, GLuint unit) {
    glBindTextureUnit(unit, tex.handle);
}

internal XGL_TexArray XGL_TexArrayNew(ivec2s size, XGL_TexFormat format, XGL_TexGPUFormat gpu_format, XGL_TexFiltering filtering, XGL_TexWrap wrap, u32 layer_count) {
    XGL_TexArray tex = {
        .size       = size,
        .format     = format,
        .gpu_format = gpu_format,
        .max_layers = layer_count,
    };
    glCreateTextures(GL_TEXTURE_2D_ARRAY, 1, &tex.handle);

    glTextureParameteri(tex.handle, GL_TEXTURE_MAG_FILTER, filtering);
    glTextureParameteri(tex.handle, GL_TEXTURE_MIN_FILTER, filtering);
    glTextureParameteri(tex.handle, GL_TEXTURE_WRAP_S, wrap);
    glTextureParameteri(tex.handle, GL_TEXTURE_WRAP_T, wrap);

    glTextureStorage3D(tex.handle, 1, format, size.width, size.height, layer_count);

    return tex;
}
internal void XGL_TexArrayUpdate(XGL_TexArray* tex, u32 layer, const void* data) {
    glTextureSubImage3D(tex->handle, 0, 0, 0, layer, tex->size.width, tex->size.height, 1, GL_RGBA, GL_UNSIGNED_BYTE, data);
}
internal void XGL_TexArrayBindToUnit(XGL_TexArray* tex, GLuint unit) {
    glBindTextureUnit(unit, tex->handle);
}
internal void XGL_TexArrayDestroy(XGL_TexArray tex) {
    glDeleteTextures(1, &tex.handle);
}
